{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "title: \"PSTAT 5A: Conditional Probability Continued & Bayes’ Theorem\"\n",
        "subtitle: \"Lecture 6\"\n",
        "author: \"Narjes Mathlouthi\"\n",
        "date: today\n",
        "format: \n",
        "  revealjs:\n",
        "    logo: /img/logo.png\n",
        "    theme: default\n",
        "    css: /files/lecture_notes/theme/lecture-styles.css\n",
        "    slide-number: true\n",
        "    chalkboard: true\n",
        "    preview-links: auto\n",
        "    footer: \"Understanding Data - Conditional Probability © 2025 Narjes Mathlouthi\"\n",
        "    transition: slide\n",
        "    background-transition: fade\n",
        "jupyter: python3\n",
        "---\n",
        "\n",
        "\n",
        "## Today's Learning Objectives {#sec-objectives .smaller}\n",
        "\n",
        "\n",
        "By the end of this lecture, you will be able to:\n",
        "\n",
        "- [Define probability and understand its basic properties](#sec-prob)\n",
        "- [Identify sample spaces and events](#sample-space)\n",
        "- [Apply fundamental probability rules](#set-operations-overview)\n",
        "- [Calculate conditional probabilities](#conditional-probability)\n",
        "- [Determine when events are independent](#independence)\n",
        "- [Use Bayes' theorem in simple applications](#bayes-theorem)\n",
        "\n",
        "--\n",
        "\n",
        "## Mutually Exclusive vs. Independent {.smaller}\n",
        "\n",
        "- **Mutually Exclusive (left):** the circles A and B do not overlap, so $P(A\\cap B)=0$.\n",
        "\n",
        "- **Independent (right):** the circles overlap, and we’ve sized the intersection so that $P(A\\cap B)=P(A)\\,P(B)$.\n"
      ],
      "id": "36475ef2"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "from matplotlib import pyplot as plt\n",
        "from matplotlib_venn import venn2\n",
        "\n",
        "# Create side-by-side Venn diagrams\n",
        "fig, axes = plt.subplots(1, 2, figsize=(12, 5))\n",
        "\n",
        "# 1) Mutually Exclusive: no overlap\n",
        "venn2(\n",
        "    subsets=(1, 1, 0),\n",
        "    set_labels=('A', 'B'),\n",
        "    ax=axes[0],\n",
        "    subset_label_formatter=lambda x: ''\n",
        ")\n",
        "axes[0].set_title('Mutually Exclusive\\nP(A∩B) = 0')\n",
        "\n",
        "# 2) Independent: overlap equals product of areas (e.g., 0.5 * 0.5 = 0.25)\n",
        "# Scale counts arbitrarily (25, 25, 25) to represent proportions\n",
        "venn2(\n",
        "    subsets=(25, 25, 25),\n",
        "    set_labels=('A', 'B'),\n",
        "    ax=axes[1],\n",
        "    subset_label_formatter=lambda x: ''\n",
        ")\n",
        "axes[1].set_title('Independent\\nP(A∩B) = P(A)P(B)')\n",
        "\n",
        "plt.tight_layout()\n",
        "plt.show()"
      ],
      "id": "644947bb",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## Mutually Exclusive vs. Independent Example {.smaller}\n",
        "\n",
        ":::{.columns}\n",
        ":::{.column}\n",
        ":::{.example}\n",
        "Draw a single card from a 52-card deck:\n",
        "\n",
        "- Let A={“draw an Ace”}, so P(A)=4/52.\n",
        "\n",
        "- Let B={“draw a King”}, so P(B)=4/52.\n",
        "\n",
        "**Q: What is $P(A\\cap B)$ ?**\n",
        "\n",
        "![](/files/lecture_notes/lecture4/img/cards.png)\n",
        ":::\n",
        ":::\n",
        "\n",
        ":::{.column}\n",
        "\n",
        "\n",
        ":::{.fragment}\n",
        ":::{.solution}\n",
        "They’re disjoint (you can’t draw an Ace and a King), so\n",
        "$P(A\\cap B) = 0$.\n",
        "\n",
        "But\n",
        "$P(A)\\,P(B) = \\frac{4}{52}\\times\\frac{4}{52} = \\frac{16}{2704} \\neq 0$.\n",
        "\n",
        "Hence, $P(A\\cap B)\\neq P(A)P(B)$, so they’re not independent.\n",
        ":::\n",
        ":::\n",
        "\n",
        "\n",
        ":::\n",
        ":::\n",
        "___\n",
        "\n",
        "## Multiplication Rule\n",
        "\n",
        "**General case**: $P(A \\cap B) = P(A) \\times P(B|A)$\n",
        "\n",
        "**Independent events**: $P(A \\cap B) = P(A) \\times P(B)$\n"
      ],
      "id": "22ba4edc"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "from matplotlib import pyplot as plt\n",
        "from matplotlib_venn import venn2\n",
        "\n",
        "# Define scaled subset sizes for illustration\n",
        "# General case: P(A)=40 (10+30), P(B|A)=0.75 so intersection=30, B-only=20 (if P(B)=50)\n",
        "# Independent case: P(A)=40, P(B)=50, intersection=P(A)*P(B)=20\n",
        "general_subsets = (10, 20, 30)   # (A-only, B-only, intersection)\n",
        "indep_subsets = (20, 30, 20)\n",
        "\n",
        "fig, axes = plt.subplots(1, 2, figsize=(14, 6))\n",
        "\n",
        "# --- General Multiplication Rule ---\n",
        "venn2(subsets=general_subsets, set_labels=('A', 'B'), ax=axes[0])\n",
        "axes[0].set_title('General: P(A∩B) = P(A)·P(B|A)', fontsize=14)\n",
        "\n",
        "# --- Independent Events ---\n",
        "venn2(subsets=indep_subsets, set_labels=('A', 'B'), ax=axes[1])\n",
        "axes[1].set_title('Independent: P(A∩B) = P(A)·P(B)', fontsize=14)\n",
        "\n",
        "plt.tight_layout()\n",
        "plt.show()\n"
      ],
      "id": "4576b218",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## Tree Diagrams{.smaller}\n",
        "\n",
        "::: {.definition}\n",
        "**🎯 Definition**\n",
        "Tree diagrams help visualize sequential events and calculate probabilities.\n",
        ":::\n"
      ],
      "id": "b0054379"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import matplotlib.pyplot as plt\n",
        "from matplotlib.patches import Circle, FancyArrowPatch\n",
        "\n",
        "# Coordinates for nodes\n",
        "coords = {\n",
        "    'root': (0.1, 0.5),\n",
        "    'A': (0.4, 0.7),\n",
        "    'B': (0.4, 0.3),\n",
        "    'A_Red': (0.7, 0.8),\n",
        "    'A_Blue': (0.7, 0.6),\n",
        "    'B_Red': (0.7, 0.4),\n",
        "    'B_Blue': (0.7, 0.2),\n",
        "}\n",
        "\n",
        "# Probabilities\n",
        "p_A = 0.7\n",
        "p_B = 0.3\n",
        "p_R_A = 0.6\n",
        "p_B_A = 0.4\n",
        "p_R_B = 0.3\n",
        "p_B_B = 0.7\n",
        "\n",
        "# Create figure\n",
        "fig, ax = plt.subplots(figsize=(8, 6))\n",
        "ax.set_xlim(0, 1)\n",
        "ax.set_ylim(0, 1)\n",
        "ax.axis('off')\n",
        "\n",
        "# Draw nodes\n",
        "for node, (x, y) in coords.items():\n",
        "    circle = Circle((x, y), 0.05, edgecolor='black', facecolor='white', linewidth=2)\n",
        "    ax.add_patch(circle)\n",
        "    label = node.replace('_', '\\n')\n",
        "    if node == 'root':\n",
        "        label = 'Start'\n",
        "    ax.text(x, y, label, ha='center', va='center', fontsize=12, fontweight='bold')\n",
        "\n",
        "# Draw arrows and annotate probabilities\n",
        "def draw_branch(start, end, text):\n",
        "    x1, y1 = coords[start]\n",
        "    x2, y2 = coords[end]\n",
        "    arrow = FancyArrowPatch((x1+0.05, y1), (x2-0.05, y2), arrowstyle='->', mutation_scale=20)\n",
        "    ax.add_patch(arrow)\n",
        "    ax.text((x1+x2)/2, (y1+y2)/2, text, fontsize=12, backgroundcolor='white', ha='center')\n",
        "\n",
        "draw_branch('root', 'A', f'{p_A}')\n",
        "draw_branch('root', 'B', f'{p_B}')\n",
        "draw_branch('A', 'A_Red', f'{p_R_A}')\n",
        "draw_branch('A', 'A_Blue', f'{p_B_A}')\n",
        "draw_branch('B', 'B_Red', f'{p_R_B}')\n",
        "draw_branch('B', 'B_Blue', f'{p_B_B}')\n",
        "\n",
        "# Title\n",
        "ax.set_title('Tree Diagram: Drawing from Urn A (70%) or B (30%)', fontsize=14, pad=20)\n",
        "\n",
        "plt.show()"
      ],
      "id": "f4ec08ff",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "## Tree Diagram Examples {.smaller}\n",
        ":::{.columns}\n",
        ":::{.column}\n"
      ],
      "id": "18cfe4cf"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import matplotlib.pyplot as plt\n",
        "from matplotlib.patches import Circle, FancyArrowPatch\n",
        "\n",
        "# Coordinates for nodes in the full tree\n",
        "coords = {\n",
        "    'root':       (0.1, 0.5),\n",
        "    'A':          (0.35, 0.75),\n",
        "    'NotA':       (0.35, 0.25),\n",
        "    'A_B':        (0.7, 0.8),\n",
        "    'A_notB':     (0.7, 0.65),\n",
        "    'NotA_B':     (0.7, 0.35),\n",
        "    'NotA_notB':  (0.7, 0.2)\n",
        "}\n",
        "\n",
        "# Probabilities (example values)\n",
        "pA     = 0.4\n",
        "pNotA  = 0.6\n",
        "pB_A   = 0.75\n",
        "pNotB_A= 0.25\n",
        "pB_notA= 0.333\n",
        "pNotB_notA=0.667\n",
        "\n",
        "# Colors\n",
        "color_intersection = '#1f77b4'  # blue\n",
        "color_B            = '#ff7f0e'  # orange\n",
        "gray               = 'lightgray'\n",
        "\n",
        "def draw_tree(highlight_branches, branch_color, node_to_color):\n",
        "    fig, ax = plt.subplots(figsize=(6, 4))\n",
        "    ax.set_xlim(0, 1)\n",
        "    ax.set_ylim(0, 1)\n",
        "    ax.axis('off')\n",
        "\n",
        "    # Draw nodes\n",
        "    node_patches = {}\n",
        "    for node, (x, y) in coords.items():\n",
        "        circ = Circle((x, y), 0.035, edgecolor='black', facecolor='white', lw=2)\n",
        "        ax.add_patch(circ)\n",
        "        node_patches[node] = circ\n",
        "        label = {\n",
        "            'root': 'Start',\n",
        "            'A': 'A',\n",
        "            'NotA': '¬A',\n",
        "            'A_B': 'B',\n",
        "            'A_notB': '¬B',\n",
        "            'NotA_B': 'B',\n",
        "            'NotA_notB': '¬B'\n",
        "        }[node]\n",
        "        ax.text(x, y, label, ha='center', va='center', fontsize=12)\n",
        "\n",
        "    # Function to draw a branch\n",
        "    def draw_branch(start, end, text, color, lw=1.5):\n",
        "        x1, y1 = coords[start]\n",
        "        x2, y2 = coords[end]\n",
        "        arr = FancyArrowPatch((x1+0.035, y1), (x2-0.035, y2),\n",
        "                              arrowstyle='-|>', mutation_scale=15,\n",
        "                              lw=lw, color=color)\n",
        "        ax.add_patch(arr)\n",
        "        ax.text((x1+x2)/2, (y1+y2)/2, text, ha='center', va='center',\n",
        "                backgroundcolor='white', fontsize=10)\n",
        "\n",
        "    # Draw all branches in gray\n",
        "    branches = [\n",
        "        ('root','A', f'{pA}'),\n",
        "        ('root','NotA', f'{pNotA}'),\n",
        "        ('A','A_B', f'{pB_A}'),\n",
        "        ('A','A_notB', f'{pNotB_A}'),\n",
        "        ('NotA','NotA_B', f'{pB_notA:.3f}'),\n",
        "        ('NotA','NotA_notB', f'{pNotB_notA:.3f}')\n",
        "    ]\n",
        "    for b in branches:\n",
        "        draw_branch(*b, color=gray)\n",
        "\n",
        "    # Highlight requested branches\n",
        "    for b in highlight_branches:\n",
        "        # find text label for branch\n",
        "        prob = {\n",
        "            ('root','A'): f'{pA}',\n",
        "            ('root','NotA'): f'{pNotA}',\n",
        "            ('A','A_B'): f'{pB_A}',\n",
        "            ('A','A_notB'): f'{pNotB_A}',\n",
        "            ('NotA','NotA_B'): f'{pB_notA:.3f}',\n",
        "            ('NotA','NotA_notB'): f'{pNotB_notA:.3f}'\n",
        "        }[b]\n",
        "        draw_branch(b[0], b[1], prob, color=branch_color, lw=3)\n",
        "    \n",
        "    # Color the end-node if desired\n",
        "    for node in node_to_color:\n",
        "        node_patches[node].set_facecolor(branch_color)\n",
        "\n",
        "    return fig, ax\n",
        "\n",
        "# Tree 1: highlight only the intersection branch root->A->A_B in blue\n",
        "fig1, ax1 = draw_tree(highlight_branches=[('root','A'),('A','A_B')],\n",
        "                      branch_color=color_intersection,\n",
        "                      node_to_color=['A_B'])\n",
        "ax1.set_title('Intersection Only (P(A∩B))', fontsize=14)\n",
        "plt.show()\n"
      ],
      "id": "c0bfe916",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::\n",
        "\n",
        ":::{.column }"
      ],
      "id": "dd4d4afe"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "# Tree 2: highlight both B branches (A->B and ¬A->B) in orange\n",
        "fig2, ax2 = draw_tree(highlight_branches=[('root','A'),('A','A_B'),\n",
        "                                          ('root','NotA'),('NotA','NotA_B')],\n",
        "                      branch_color=color_B,\n",
        "                      node_to_color=['A_B','NotA_B'])\n",
        "ax2.set_title('Event B Only (P(B))', fontsize=14)\n",
        "plt.show()"
      ],
      "id": "584562c0",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::\n",
        ":::\n",
        "\n",
        "\n",
        "\n",
        "\n",
        "## Practice Problem 2{.smaller}\n",
        "\n",
        ":::{.columns}\n",
        ":::{.column}\n",
        ":::{.example}\n",
        "A jar contains 5 red balls and 3 blue balls. Two balls are drawn **without replacement**.\n",
        "\n",
        "a) What's the probability both balls are red?\n",
        "\n",
        "b) What's the probability the first is red and second is blue?\n",
        ":::\n",
        ":::\n",
        "\n",
        ":::{.column}\n",
        ":::{.fragment}\n"
      ],
      "id": "fa472ad5"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import matplotlib.pyplot as plt\n",
        "from matplotlib.patches import Circle\n",
        "from matplotlib.lines import Line2D\n",
        "\n",
        "# Set up figure\n",
        "fig, ax = plt.subplots(figsize=(10, 6))\n",
        "ax.axis('off')\n",
        "\n",
        "# Node positions\n",
        "positions = {\n",
        "    'root': (0.1, 0.5),\n",
        "    'R': (0.35, 0.7),\n",
        "    'B': (0.35, 0.3),\n",
        "    'RR': (0.7, 0.8),\n",
        "    'RB': (0.7, 0.6),\n",
        "    'BR': (0.7, 0.4),\n",
        "    'BB': (0.7, 0.2),\n",
        "}\n",
        "\n",
        "# Define colors\n",
        "color_root = '#ecf0f1'\n",
        "color_R = '#e74c3c'       # red for R or RR\n",
        "color_B = '#3498db'       # blue for B or BB\n",
        "color_mixed = '#ff7f0e'   # orange for mixed (RB, BR)\n",
        "edge_color = 'black'\n",
        "linewidth = 2\n",
        "text_fs = 12\n",
        "\n",
        "# Draw nodes with colored backgrounds and bold labels\n",
        "node_colors = {\n",
        "    'root': color_root,\n",
        "    'R': color_R,\n",
        "    'B': color_B,\n",
        "    'RR': color_R,\n",
        "    'RB': color_mixed,\n",
        "    'BR': color_mixed,\n",
        "    'BB': color_B\n",
        "}\n",
        "\n",
        "for name, (x, y) in positions.items():\n",
        "    circ = Circle((x, y), 0.05, facecolor=node_colors[name],\n",
        "                  edgecolor=edge_color, linewidth=linewidth, zorder=2)\n",
        "    ax.add_patch(circ)\n",
        "    ax.text(x, y, name, ha='center', va='center', fontsize=text_fs, fontweight='bold', zorder=3)\n",
        "\n",
        "# Function to draw an arrow and label\n",
        "def draw_arrow(src, dst, label):\n",
        "    x1, y1 = positions[src]\n",
        "    x2, y2 = positions[dst]\n",
        "    ax.annotate('', xy=(x2-0.05, y2), xytext=(x1+0.05, y1),\n",
        "                arrowprops=dict(arrowstyle='->', color=node_colors[dst], lw=linewidth), zorder=1)\n",
        "    ax.text((x1+x2)/2, (y1+y2)/2, label, ha='center', va='center',\n",
        "            backgroundcolor='white', fontsize=text_fs, fontweight='bold', zorder=3)\n",
        "\n",
        "# Draw branches with probabilities\n",
        "draw_arrow('root', 'R', '5/8')\n",
        "draw_arrow('root', 'B', '3/8')\n",
        "draw_arrow('R', 'RR', '4/7')\n",
        "draw_arrow('R', 'RB', '3/7')\n",
        "draw_arrow('B', 'BR', '5/7')\n",
        "draw_arrow('B', 'BB', '2/7')\n",
        "\n",
        "# Label leaves with final probabilities in bold\n",
        "leaf_probs = {\n",
        "    'RR': '20/56',\n",
        "    'RB': '15/56',\n",
        "    'BR': '15/56',\n",
        "    'BB': '6/56'\n",
        "}\n",
        "for leaf, prob in leaf_probs.items():\n",
        "    x, y = positions[leaf]\n",
        "    ax.text(x+0.12, y, prob, ha='left', va='center', fontsize=text_fs, fontweight='bold')\n",
        "\n",
        "# Legend\n",
        "legend_elements = [\n",
        "    Line2D([0], [0], marker='o', color='w', label='RR / R',\n",
        "           markerfacecolor=color_R, markersize=12, markeredgecolor=edge_color),\n",
        "    Line2D([0], [0], marker='o', color='w', label='BB / B',\n",
        "           markerfacecolor=color_B, markersize=12, markeredgecolor=edge_color),\n",
        "    Line2D([0], [0], marker='o', color='w', label='RB / BR',\n",
        "           markerfacecolor=color_mixed, markersize=12, markeredgecolor=edge_color),\n",
        "]\n",
        "ax.legend(handles=legend_elements, loc='upper left', bbox_to_anchor=(0.02, 0.95))\n",
        "\n",
        "plt.tight_layout()\n",
        "plt.show()"
      ],
      "id": "75872ff9",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::{.solution}\n",
        "a) $P(\\text{both red}) = \\frac{5}{8} \\times \\frac{4}{7} = \\frac{20}{56} = \\frac{5}{14}$\n",
        "\n",
        "b) $P(\\text{red then blue}) = \\frac{5}{8} \\times \\frac{3}{7} = \\frac{15}{56}$\n",
        ":::\n",
        ":::\n",
        ":::\n",
        "\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "## Law of Total Probability {.smaller}\n",
        "\n",
        ":::{.definition}\n",
        "**🎯 Definition**\n",
        "\n",
        "If events $B_1, B_2, \\ldots, B_n$ form a partition of the sample space, then:\n",
        "\n",
        "$$P(A) = P(A|B_1)P(B_1) + P(A|B_2)P(B_2) + \\cdots + P(A|B_n)P(B_n)$$\n",
        ":::"
      ],
      "id": "452fbd3d"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import matplotlib.pyplot as plt\n",
        "from matplotlib.patches import Circle, Ellipse, Rectangle\n",
        "\n",
        "# Example probabilities\n",
        "P_B = [0.3, 0.5, 0.2]\n",
        "P_A_given_B = [0.2, 0.6, 0.5]\n",
        "P_A_and_B = [P_B[i] * P_A_given_B[i] for i in range(3)]\n",
        "\n",
        "# Create figure\n",
        "fig, ax = plt.subplots(figsize=(9, 5))\n",
        "ax.set_aspect('equal')\n",
        "ax.axis('off')\n",
        "\n",
        "# Draw sample space rectangle\n",
        "rect = Rectangle((-1, -2), width=8, height=4, edgecolor='black', facecolor='none', linewidth=2)\n",
        "ax.add_patch(rect)\n",
        "ax.text(-0.9, 1.7, r'$\\Omega$', fontsize=14, fontweight='bold', va='top', ha='left')\n",
        "\n",
        "# Draw B partitions as circles\n",
        "positions_B = [(1, 0), (3, 0), (5, 0)]\n",
        "colors_B = ['#ffcc00', '#ff6600', '#ff0066']\n",
        "\n",
        "for i, (x, y) in enumerate(positions_B):\n",
        "    circle = Circle((x, y), radius=1, facecolor=colors_B[i], edgecolor='black', alpha=0.3)\n",
        "    ax.add_patch(circle)\n",
        "    ax.text(x, y-1.3, f'$P(B_{i+1})={P_B[i]:.2f}$', ha='center', va='center', fontsize=12, fontweight='bold')\n",
        "\n",
        "# Draw A as a large ellipse overlapping all B's\n",
        "ellipse = Ellipse((3, 0), width=8, height=3, angle=0, facecolor='#1f77b4', edgecolor='black', alpha=0.2)\n",
        "ax.add_patch(ellipse)\n",
        "ax.text(3, 1.2, '$A$', ha='center', va='center', fontsize=14, fontweight='bold')\n",
        "\n",
        "# Annotate intersections P(A ∩ Bi)\n",
        "for i, (x, y) in enumerate(positions_B):\n",
        "    ax.text(x, 0, f'$P(A\\\\cap B_{i+1})={P_A_and_B[i]:.2f}$', ha='center', va='center', fontsize=12, color='black', fontweight='bold')\n",
        "\n",
        "ax.set_xlim(-1, 7)\n",
        "ax.set_ylim(-2, 2)\n",
        "plt.show()"
      ],
      "id": "f46d7440",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "\n",
        "\n",
        "## Law of Total Probability Example{.smaller}\n",
        "\n",
        ":::{.example}\n",
        "\n",
        "A factory has two machines:\n",
        "\n",
        "- Machine 1: Produces 60% of items, 5% defective\n",
        "  \n",
        "- Machine 2: Produces 40% of items, 3% defective\n",
        "\n",
        "**Q: What's the overall probability an item is defective?**\n",
        ":::\n",
        "\n",
        "\n",
        ":::{.fragment}\n",
        ":::{.solution}\n",
        "\n",
        "$P(\\text{defective}) = P(D|M_1)P(M_1) + P(D|M_2)P(M_2)$ \n",
        "\n",
        "$= 0.05 \\times 0.6 + 0.03 \\times 0.4 = 0.03 + 0.012 = 0.042$\n",
        ":::\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "## Bayes' Theorem\n",
        "\n",
        "::: {.definition}\n",
        "**🎯 Definition**\n",
        "$$P(A|B) = \\frac{P(B|A) \\times P(A)}{P(B)}$$\n",
        "\n",
        "This allows us to \"reverse\" conditional probabilities\n",
        "\n",
        "*Named after Thomas Bayes (1701-1761)*\n",
        "\n",
        "![](/files/lecture_notes/lecture4/img/bayes.gif){width=\"200\" fig-align=\"right\"}\n",
        ":::\n",
        "\n",
        "\n",
        "\n",
        "\n",
        "---\n",
        "\n",
        "## Bayes' Theorem Components\n",
        "\n",
        "- $A,B$: **Events**\n",
        "- $P(A|B)$: **Posterior probability** - what we want to find\n",
        "- $P(B|A)$: **Likelihood** - given $A$, probability of observing $B$\n",
        "- $P(A)$: **Prior probability** - initial probability of $A$\n",
        "- $P(B)$: **Marginal probability** - total probability of $B$\n",
        "\n",
        "---\n",
        "\n",
        "## Bayes' Theorem Example {.smaller}\n",
        "\n",
        ":::{.columns}\n",
        ":::{.column width =\"40%\"}\n",
        ":::{.example}\n",
        "**Medical test for a disease:** ^[$P(\\neg D \\,\\wedge\\, \\text{Negative})\n",
        "\\;=\\;P(\\neg D)\\times P(\\text{Negative}\\mid \\neg D)\n",
        "\\;=\\;0.99\\times0.90\n",
        "\\;=\\;0.891\\;(89.1\\%)$]\n",
        "\n",
        "- Disease affects 1% of population\n",
        "  \n",
        "- Test is 95% accurate for sick people\n",
        "  \n",
        "- Test is 90% accurate for healthy people\n",
        "\n",
        "\n",
        "\n",
        "**Q:If someone tests positive, what's the probability they have the disease?**\n",
        "\n",
        ":::\n",
        ":::\n",
        "\n",
        ":::{.column width=\"60%\"}\n"
      ],
      "id": "e5ee37b9"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import plotly.express as px\n",
        "import pandas as pd\n",
        "\n",
        "# Given probabilities\n",
        "P_D = 0.01\n",
        "P_notD = 0.99\n",
        "P_pos_given_D = 0.95\n",
        "P_pos_given_notD = 0.10\n",
        "\n",
        "# Joint probabilities\n",
        "P_D_and_pos = P_D * P_pos_given_D       # True positives\n",
        "P_notD_and_pos = P_notD * P_pos_given_notD  # False positives\n",
        "P_D_and_neg = P_D * (1 - P_pos_given_D)     # False negatives\n",
        "P_notD_and_neg = P_notD * (1 - P_pos_given_notD)  # True negatives\n",
        "\n",
        "# Prepare DataFrame for treemap (mosaic)\n",
        "df = pd.DataFrame({\n",
        "    'Test Result': ['Positive', 'Positive', 'Negative', 'Negative'],\n",
        "    'Condition':   ['Disease',   'No Disease', 'Disease',   'No Disease'],\n",
        "    'Probability': [P_D_and_pos, P_notD_and_pos, P_D_and_neg, P_notD_and_neg]\n",
        "})\n",
        "\n",
        "# Create treemap mosaic plot\n",
        "fig = px.treemap(\n",
        "    df,\n",
        "    path=['Test Result', 'Condition'],\n",
        "    values='Probability',\n",
        "    color='Condition',\n",
        "    color_discrete_map={'Disease':'tomato', 'No Disease':'skyblue'}\n",
        ")\n",
        "fig.update_traces(textinfo='label+percent entry')\n",
        "fig.update_layout(\n",
        "    title='Bayes’ Theorem: Distribution by Test Result and Condition',\n",
        "    margin=dict(t=50, l=25, r=25, b=25)\n",
        ")\n",
        "fig.show()"
      ],
      "id": "1da2f71f",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "## Bayes' Theorem Solution {.smaller}\n",
        "\n",
        "Let:\n",
        "\n",
        "- $D$: Person has disease\n",
        "  \n",
        "- $T^+$: Test is positive\n",
        "\n",
        "Given:\n",
        "\n",
        "- $P(D) = 0.01$\n",
        "  \n",
        "- $P(T^+|D) = 0.95$\n",
        "  \n",
        "- $P(T^-|D^c) = 0.90$, so $P(T^+|D^c) = 0.10$\n",
        "\n",
        ":::{.fragment}\n",
        ":::{.solution}\n",
        "$P(T^+) = P(T^+|D)P(D) + P(T^+|D^c)P(D^c)$\n",
        "\n",
        "$= 0.95 \\times 0.01 + 0.10 \\times 0.99 = 0.1085$\n",
        ":::\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "\n",
        "## Bayes' Theorem Solution (cont.) {.smaller}\n",
        "\n",
        "$$P(D|T^+) = \\frac{P(T^+|D) \\times P(D)}{P(T^+)} = \\frac{0.95 \\times 0.01}{0.1085} \\approx 0.088$$\n"
      ],
      "id": "33c13005"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import matplotlib.pyplot as plt\n",
        "\n",
        "# Posterior probabilities given a positive test\n",
        "P_D_and_pos = 0.0095\n",
        "P_notD_and_pos = 0.099\n",
        "P_positive = P_D_and_pos + P_notD_and_pos\n",
        "\n",
        "P_D_given_pos = P_D_and_pos / P_positive\n",
        "P_notD_given_pos = P_notD_and_pos / P_positive\n",
        "\n",
        "# Pie chart\n",
        "labels = ['Disease (P≈8.8%)', 'No Disease (P≈91.2%)']\n",
        "sizes = [P_D_given_pos, P_notD_given_pos]\n",
        "colors = ['tomato', 'skyblue']\n",
        "\n",
        "fig, ax = plt.subplots(figsize=(6, 6))\n",
        "ax.pie(\n",
        "    sizes, labels=labels, colors=colors, autopct='%.1f%%',\n",
        "    startangle=90, textprops={'fontsize': 14, 'fontweight': 'bold'}\n",
        ")\n",
        "ax.set_title('Posterior Probability Given Positive Test', fontsize=16, fontweight='bold')\n",
        "ax.axis('equal')  # Equal aspect ensures pie is circular.\n",
        "plt.show()"
      ],
      "id": "1c5d79e6",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        ":::{.fragment}\n",
        ":::{.note}\n",
        "**Surprising result**: Even with a positive test, there's only an 8.8% chance of having the disease!\n",
        "\n",
        "*This is due to the low base rate of the disease*\n",
        ":::\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "## Common Probability Mistakes {.smaller}\n",
        "\n",
        "- **Confusing $P(A|B)$ with $P(B|A)$**\n",
        "   \n",
        ":::{.note}\n",
        "[Prosecutor's fallacy](https://en.wikipedia.org/wiki/Base_rate_fallacy) is a specific error in interpreting conditional probabilities.\n",
        "Confusing \n",
        "\n",
        "$P(\\text{Evidence}\\mid\\text{Innocent})\n",
        "\\quad\\text{with}\\quad\n",
        "P(\\text{Innocent}\\mid\\text{Evidence})$. \n",
        "\n",
        "Ex: OJ Simpson Case ^[the DNA evidence in the O. J. Simpson trial are a classic example of the prosecutor’s fallacy.  Prosecutors highlighted that the chance of a random person matching the crime-scene DNA was “one in 170 million,” then implied (or let the jury infer) that Simpson therefore had a 1 in 170 million chance of being innocent.]\n",
        ":::\n",
        "\n",
        "\n",
        "---\n",
        "\n",
        "## Common Probability Mistakes {.smaller}\n",
        "\n",
        "-  **Assuming independence when events are dependent**\n",
        "\n",
        "-  **Ignoring base rates** (as in the medical test example)\n",
        "\n",
        ":::{.note}\n",
        "[Base rate fallacy](https://en.wikipedia.org/wiki/Base_rate_fallacy) is when you ignore or underweight the prior probability $P(H)$ of a hypothesis, focusing only on the new evidence $E$.\n",
        ":::\n",
        "\n",
        "-  **Double counting in union calculations**\n",
        "\n",
        "\n",
        "---\n",
        "\n",
        "## Practice Problem 3 {.smaller}\n",
        ":::{.example}\n",
        "Two fair dice are rolled. Find:\n",
        "\n",
        "a) $P(\\text{sum} = 7)$\n",
        "b) $P(\\text{sum} = 7 | \\text{first die shows 3})$\n",
        "c) Are these events independent?\n",
        ":::\n",
        "\n",
        ":::{.fragment}\n",
        ":::{.solution}\n",
        "a) 6 ways out of 36: $P(\\text{sum} = 7) = \\frac{6}{36} = \\frac{1}{6}$\n",
        "\n",
        "b) Given first die is 3, need second die to be 4: $P(\\text{sum} = 7 | \\text{first} = 3) = \\frac{1}{6}$\n",
        "\n",
        "c) Yes, they're independent since $P(A|B) = P(A)$\n",
        ":::\n",
        ":::\n",
        "\n",
        "\n",
        "---\n",
        "\n",
        "## Counting and Probability{.smaller}\n",
        "\n",
        ":::{.definition}\n",
        "Sometimes we need to count outcomes:\n",
        "\n",
        ":::{.formula-box}\n",
        "**Multiplication Principle**: If task 1 can be done in $m$ ways and task 2 in $n$ ways, both can be done in $m \\times n$ ways\n",
        ":::\n",
        "\n",
        ":::{.formula-box}\n",
        "**Permutations**: Arrangements where order matters\n",
        "$$P(n,r) = \\frac{n!}{(n-r)!}$$\n",
        ":::\n",
        "\n",
        ":::{.formula-box}\n",
        "**Combinations**: Selections where order doesn't matter\n",
        "$$C(n,r) = \\binom{n}{r} = \\frac{n!}{r!(n-r)!}$$\n",
        ":::\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "## Counting Example\n",
        "\n",
        ":::{.example}\n",
        "**Q: How many ways can you arrange 5 people in a row?**\n",
        ":::\n",
        "\n",
        ":::{.fragment}\n",
        ":::{.solution}\n",
        "This is a permutation: $P(5,5) = 5! = 120$ ways\n",
        ":::\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "\n",
        ":::{.fragment}\n",
        ":::{.example}\n",
        "**Q:How many ways can you choose 3 people from 5 for a committee?**\n",
        ":::\n",
        ":::\n",
        "\n",
        ":::{.fragment}\n",
        ":::{.solution}\n",
        "This is a combination: $C(5,3) = \\binom{5}{3} = \\frac{5!}{3!2!} = 10$ ways\n",
        ":::\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "## Probability with Counting\n",
        "\n",
        ":::{.example}\n",
        "**Example**: A committee of 3 people is chosen from 8 people (5 women, 3 men). What's the probability all 3 are women?\n",
        ":::\n",
        "\n",
        ":::{.fragment}\n",
        ":::{.solution}\n",
        "Total ways to choose 3 from 8: $\\binom{8}{3} = 56$\n",
        "\n",
        "Ways to choose 3 women from 5: $\\binom{5}{3} = 10$\n",
        "\n",
        "Probability: $\\frac{10}{56} = \\frac{5}{28}$\n",
        ":::\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "\n",
        "## Real-World Applications\n",
        "\n",
        "**Medical Diagnosis**: Using Bayes' theorem for test interpretation\n",
        "\n",
        "**Quality Control**: Probability of defective items\n",
        "\n",
        "**Finance**: Risk assessment and portfolio theory\n",
        "\n",
        "**Sports**: Probability of wins, fantasy sports\n",
        "\n",
        "**Insurance**: Calculating premiums based on risk\n",
        "\n",
        "---\n",
        "\n",
        "## Key Formulas Summary\n",
        "\n",
        ":::{.formula-box}\n",
        "- **Basic probability**: $P(A) = \\frac{\\text{favorable outcomes}}{\\text{total outcomes}}$\n",
        "- **Complement**: $P(A^c) = 1 - P(A)$\n",
        "- **Addition**: $P(A \\cup B) = P(A) + P(B) - P(A \\cap B)$\n",
        "- **Conditional**: $P(A|B) = \\frac{P(A \\cap B)}{P(B)}$\n",
        "- **Independence**: $P(A \\cap B) = P(A) \\times P(B)$\n",
        "- **Bayes'**: $P(A|B) = \\frac{P(B|A) \\times P(A)}{P(B)}$\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "## Problem-Solving Strategy\n",
        "\n",
        ":::{.note}\n",
        "1. **Identify** the sample space and events\n",
        "2. **Determine** if events are independent or mutually exclusive\n",
        "3. **Choose** the appropriate rule or formula\n",
        "4. **Calculate** step by step\n",
        "5. **Check** if your answer makes sense\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "## Practice Problem 4\n",
        "\n",
        ":::{.example}\n",
        "A bag contains 4 red, 3 blue, and 2 green marbles. Three marbles are drawn without replacement.\n",
        "\n",
        "Find the probability that:\n",
        "a) All three are red\n",
        "b) No two are the same color\n",
        "c) At least one is blue\n",
        "\n",
        ":::\n",
        "---\n",
        "\n",
        "\n",
        "## Practice Problem 4 Solutions\n",
        "\n",
        ":::{.solution}\n",
        "a) All red: $\\frac{4}{9} \\times \\frac{3}{8} \\times \\frac{2}{7} = \\frac{24}{504} = \\frac{1}{21}$\n",
        "\n",
        "b) Different colors: $\\frac{4 \\times 3 \\times 2}{9 \\times 8 \\times 7} \\times 3! = \\frac{24 \\times 6}{504} = \\frac{144}{504} = \\frac{2}{7}$\n",
        "\n",
        "c) At least one blue: $1 - P(\\text{no blue}) = 1 - \\frac{6 \\times 5 \\times 4}{9 \\times 8 \\times 7} = 1 - \\frac{120}{504} = \\frac{384}{504} = \\frac{16}{21}$\n",
        ":::\n",
        "\n",
        "---\n",
        "\n",
        "## Common Questions {.smaller}\n",
        "\n",
        ":::{.example}\n",
        "**Q1.**: **\"Why isn't $P(A \\cup B) = P(A) + P(B)$ always?\"**\n",
        "\n",
        "**A**: We'd double-count outcomes in both events\n",
        "\n",
        "**Q2.**: **\"How do I know if events are independent?\"**\n",
        "\n",
        "**A**: Check if $P(A|B) = P(A)$ or if $P(A \\cap B) = P(A) \\times P(B)$\n",
        "\n",
        "**Q3.**: **\"When do I use Bayes' theorem?\"**\n",
        "\n",
        "**A**: When you want to \"reverse\" a conditional probability\n",
        "\n",
        ":::\n",
        "\n",
        ":::{.note}\n",
        "*Q3 note (Bayes Example)*\n",
        "\n",
        "- Forward: I know my test picks up disease 95% of the time ⇒ $P(+\\mid D)=0.95$.\n",
        "\n",
        "- Reverse: I want the chance I really have the disease when the test is positive ⇒ $P(D\\mid +)$.\n",
        ":::\n",
        "---\n",
        "\n",
        "\n",
        "## Looking Ahead\n",
        "\n",
        "**Next lecture**: \n",
        "\n",
        "- Random Variables and Probability Distributions\n",
        "  \n",
        "- Discrete vs. continuous random variables\n",
        "  \n",
        "- Expected value and variance\n",
        "  \n",
        "\n",
        "\n",
        "\n",
        "---\n",
        "\n",
        "## Final Thoughts\n",
        "\n",
        ":::{.note}\n",
        "Probability is the foundation of statistics:\n",
        "\n",
        "- Helps us quantify uncertainty\n",
        "  \n",
        "- Provides tools for making decisions with incomplete information\n",
        "  \n",
        "- Essential for understanding statistical inference\n",
        ":::\n",
        "\n",
        ":::{.fragment}\n",
        "**Practice**: The key to mastering probability is working through many problems!\n",
        ":::\n",
        "\n",
        "## Questions? {.center}\n",
        "\n",
        "**Office Hours**: Thursday's 11 AM On Zoom (Link on Canvas)\n",
        "\n",
        "**Email**: nmathlouthi@ucsb.edu\n",
        "\n",
        "**Next Class**: Random Variables and Distributions\n",
        "\n",
        "\n",
        "\n",
        "---\n",
        "\n",
        "## Resources\n",
        "\n",
        "- [Read Chapter 3 in course textbook]((/files/Book/os4_for_screen_reader.pdf))\n",
        "  \n",
        "- [Elements of Set Theory for Probability](https://bookdown.org/daniel_flores_agreda/Prob1-GSEM-UNIGE/settheory.html#the-venn-diagram)\n",
        "\n",
        "- [Probability Models and Axioms](https://ocw.mit.edu/courses/res-6-012-introduction-to-probability-spring-2018/resources/mitres_6_012s18_l01as/)"
      ],
      "id": "7a2786b7"
    }
  ],
  "metadata": {
    "kernelspec": {
      "name": "python3",
      "language": "python",
      "display_name": "Python 3 (ipykernel)",
      "path": "/opt/miniconda3/share/jupyter/kernels/python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}